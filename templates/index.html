<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Advanced Markov Text Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 24px; }
      .container { max-width: 900px; margin: auto; }
      textarea { width: 100%; min-height: 160px; }
      input, select { padding: 6px; margin: 4px 0; }
      .card { border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
      .small { font-size: 0.9rem; color: #555; }
      .btn { padding: 8px 12px; border-radius: 6px; cursor: pointer; }
      .btn-primary { background:#0366d6; color:white; border:none; }
      .btn-ghost { background:transparent; border:1px solid #0366d6; color:#0366d6; }
      .flash { padding:8px; border-radius:6px; margin-bottom:12px; }
      .success { background:#e6ffed; border:1px solid #9ae6b4; }
      .danger { background:#ffeef0; border:1px solid #f5c6cb; }
      pre { white-space: pre-wrap; background:#f7f7f8; padding:12px; border-radius:6px; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Advanced Markov Text Generator (Flask)</h1>
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for cat, msg in messages %}
            <div class="flash {{ 'success' if cat=='success' else 'danger' }}">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
      <div class="card">
        <h3>Train Model</h3>
        <form method="post">
          <input type="hidden" name="action" value="train">
          <label>Mode: <select name="mode"><option value="word">word</option><option value="char">char</option></select></label><br>
          <label>Order: <input name="order" value="2" size="3"></label>
          <label>Prune min count: <input name="prune_min" value="2" size="3"></label><br>
          <label>Sample file: <select name="sample_file"><option value="none">All samples</option>{% for s in samples %}<option value="{{ s }}">{{ s }}</option>{% endfor %}</select></label><br>
          <button class="btn btn-primary" type="submit">Train</button>
        </form>
      </div>

      <div class="card">
        <h3>Generate / Evaluate</h3>
        <form method="post">
          <input type="hidden" name="action" value="generate">
          <label>Length (tokens): <input name="length" value="120" size="5"></label>
          <label>Seed (optional): <input name="seed" size="6"></label>
          <label>Start state (optional): <input name="start" size="20"></label><br>
          <label>Add-k smoothing (for generation & evaluation): <input name="add_k" value="0.0" size="6"></label>
          <label>Mode: <select name="mode"><option value="word">word</option><option value="char">char</option></select></label>
          <button class="btn btn-primary" type="submit">Generate</button>
        </form>
        <form method="post" style="margin-top:8px;">
          <input type="hidden" name="action" value="perplexity">
          <label>Evaluation text (for perplexity):</label><br>
          <textarea name="eval_text" placeholder="Paste evaluation text here..."></textarea><br>
          <label>Add-k smoothing: <input name="add_k" value="0.0" size="6"></label>
          <button class="btn btn-ghost" type="submit">Compute Perplexity</button>
        </form>
      </div>

      {% if info.generated %}
      <div class="card">
        <h3>Generated Text</h3>
        <pre>{{ info.generated }}</pre>
      </div>
      {% endif %}

      {% if info.perplexity is defined %}
      <div class="card">
        <h3>Perplexity</h3>
        <p class="small">Perplexity: <strong>{{ info.perplexity }}</strong></p>
      </div>
      {% endif %}

      <div class="card small">
        <h4>Sample datasets</h4>
        <ul>
          {% for s in samples %}
            <li>{{ s }} â€” <a href="{{ url_for('download', filename=s) }}">download</a></li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </body>
</html>
